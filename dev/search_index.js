var documenterSearchIndex = {"docs":
[{"location":"fitting/#Fitting-a-CARS-spectrum","page":"Fitting","title":"Fitting a CARS spectrum","text":"In NTECARS, for fitting a spectrum, first a CARSSimulator struct has to be created for the given conditions. As an example, we will create this object here, generate a synthetic spectrum and then fit it.\n\nusing NTECARS\nconditions = GasConditions(\n    pressure = 15000.0, # in Pa\n    T_gas    = 600.0    # in K\n)\n\nlasers = LaserConfiguration(\n    wavelength_1 = 532e-9,  # First laser wavelength in nm \n    wavelength_2 = 561e-9,  # Second laser wavelength in nm\n    stokes_range = (600e-9, 610e-9),\n)\n\ninstrument = InstrumentConfiguration(\n    profile = Gaussian(0.5/2.35)\n)\n\nN2_species = N2Species(\n    molar_fraction = 0.9, \n    distribution = N2.MultiTemperatureDistribution(T_vib = 2200.0, T_rot = 600.0), \n)\n\nCO2_species = CO2Species(\n    molar_fraction = 0.1, \n    distribution = CO2.MultiTemperatureDistribution(T_12 = 600.0, T_3 = 1800.0, T_rot = 600.0),\n    v_max = (0,1,1)\n)\n\nsim  = CARSSimulator(\n    species    = [CO2_species, N2_species], \n    conditions = conditions, \n    lasers     = lasers, \n    instrument = instrument,\n)\n\nsynthetic_spectrum = simulate_spectrum(sim)\nnothing #hide\n\nIn NTECARS, to fit a set of parameters, an update function has to be defined which updates the CARSSimulator from an array of parameters such as \n\nfunction update_function!(sim::CARSSimulator, param)\n    T_12, T_3, T_N2vib, T_rot, CO2_frac = param\n    \n    # update translational temperature\n    sim.conditions.T_gas = T_rot \n    \n    # update CO2\n    sim.species[1].molar_fraction = CO2_frac\n    sim.species[1].distribution = CO2.MultiTemperatureDistribution(\n        T_12 = T_12, T_3 = T_3, T_rot = T_rot)\n    \n    #update N2\n    sim.species[2].molar_fraction = 1-CO2_frac\n    sim.species[2].distribution = N2.MultiTemperatureDistribution(\n        T_vib = T_N2vib, T_rot = T_rot)\nend\nnothing #hide\n\nFitting is then performed by giving the experimental data as a Spectrum to the fit_spectrum() function together with the CARSSimulator, the update function and initial conditions and boundaries.\n\nresult = fit_spectrum(;\n    spec_exp     = synthetic_spectrum,\n    sim          = sim, \n    initial      = [500.0, 500.0, 500.0, 500.0, 0.1], \n    lower        = [0.0, 0.0, 0.0, 0.0, 0.0],\n    upper        = [3000.0, 3000.0, 3000.0, 3000.0, 1.0],\n    parameter_update_function! = update_function!\n)\nresult.param\n\nThe fitted parameters, spectra and rovibrational populations together with their uncertainties can be saved using\n\nsave_fit_results(folder_path, result)","category":"section"},{"location":"Setup_for_spectra/#Getting-Started-with-CARS-spectra-Calculation","page":"Setup for Spectra Calculation","title":"Getting Started with CARS-spectra Calculation","text":"The NTECARS code works around the CARSSimulator object, which contains all data necessary to calculated a CARS spectrum. This object is required both for the forward calculation of a CARS spectrum but also to fit. When fitting, the CARSSimulator object is the starting point and gets iteratively modified.","category":"section"},{"location":"Setup_for_spectra/#Spectra-struct","page":"Setup for Spectra Calculation","title":"Spectra struct","text":"All CARS spectra, laser profiles and instrumental profiles are Spectrum objects. For the laser profiles and instrumental profile, the code implements constructors for different profiles like Gaussian, or Voigt profiles. Otherwise, the Spectrum has to be  created from discrete data. A Spectrum can be constructed from either wavelengths (m) and intensities as an input:\n\nλ  = [404e-9, 405e-9, 406e-9]\nI  = [0.0, 1.0, 0.0]\ns  = Spectrum(λ, I, :wavelength)\nnothing #hide\n\nor Spectrum can be constructed from wavenumbers (cm¹) and intensities as an input:\n\nν  = [20000, 21000, 22000]\nI  = [0.0, 1.0, 0.0]\ns  = Spectrum(ν, I, :wavenumber)\nnothing #hide\n\nWhen working with structs it is recommended to use the getter-functions which automatically handle unit conversions or normalizations\n\nν  = wavenumbers(s)\nλ  = wavelengths(s)\nI  = intensities(s)\nI  = intensities(s, normalization = :maximum)\nI  = intensities(s, normalization = :sum)\nnothing #hide","category":"section"},{"location":"Setup_for_spectra/#GasConditions","page":"Setup for Spectra Calculation","title":"GasConditions","text":"The bulk-gas parameters of pressure (Pa) and translational temperature (K) are used for the calculation and stored in GasConditions:\n\nconditions = GasConditions(\n    pressure = 15000.0, # in Pa\n    T_gas    = 600.0    # in K\n)\nnothing #hide","category":"section"},{"location":"Setup_for_spectra/#LaserConfiguration","page":"Setup for Spectra Calculation","title":"LaserConfiguration","text":"Information about the wavelengths and profiles of the lasers is stored in LaserConfiguration. The minimum inputs are the central wavelengths of laser 1 and laser 2 and the spectral range of the Stokes-laser that determines the evaluated anti-Stokes frequencies. All inputs are in units of wavelength (m):\n\nlasers = LaserConfiguration(\n    wavelength_1    = 532e-9,\n    wavelength_2    = 561e-9,\n    stokes_range    = (600e-9, 610e-9)\n)\nnothing #hide\n\noptional arguments are profile_1, profile_2 which are DeltaProfile() by default and the stokes_profile which is FlatProfile() be default. All three profiles can be passed a custom Spectrum. The narrow laser profiles profile_1, profile_2 should be centerd around 0.0 and the stokes_profile should be  at the correct absolute wavelength. For the convolutions, the profiles are interpolated, so they dont have to be defined at specific points. An example is:\n\nlasers = LaserConfiguration(\n    wavelength_1    = 532e-9,\n    wavelength_2    = 561e-9,\n    stokes_range    = (600e-9, 610e-9),\n    profile_1       = Gaussian(0.2), # inputs are σ\n    profile_2       = Voigt(0.1, 0.05), # inputs are σ, γ\n    stokes_profile  = Spectrum([600e-9, 605e-9, 610e-0], [0.0, 1.0, 0.0], :wavelength)\n)\nnothing #hide","category":"section"},{"location":"Setup_for_spectra/#Instrumental-Broadening","page":"Setup for Spectra Calculation","title":"Instrumental Broadening","text":"just like in the LaserConfiguration, the instrumental profile can be a custom Spectrum, which should be centered around 0.0 or be passed pre-implemted profiles such as Gaussian or Voigt. By default, teh instrumental profile is a DeltaProfile() e.g. it introduces no broadening.\n\ninstrument = InstrumentConfiguration(\n    profile = Gaussian(0.1/2.35)\n)\nnothing #hide","category":"section"},{"location":"Setup_for_spectra/#Molecular-species","page":"Setup for Spectra Calculation","title":"Molecular species","text":"Each molecule is represented in the code as a struct. The minimum for their construction is a molar fraction and a distribution \n\nN2_species  = N2Species(\n    molar_fraction = 0.9, \n    distribution = N2.MultiTemperatureDistribution(T_vib = 2200.0, T_rot = 600.0), \n)\n\nCO2_species = CO2Species(\n    molar_fraction = 0.1, \n    distribution = CO2.MultiTemperatureDistribution(T_12 = 600.0, T_3 = 1800.0, T_rot = 600.0),\n)\nnothing #hide\n\nHere distribution functions can be set to different functions. For the implementation of custom distribution functions, please check the implementation of the current ones. They need to be structs that are subtypes of the abstract types CO2Distribution and N2.distribution respecitvely, and be callable as distribution(state) where state is a CO2.State or N2.State respectively. Especially for CO2, the calculation time of a spectrum rapidly increases with the maximum quantum numbers evaluated for a spectrum increasing.  For this reason, the maximum quantum numbers considered for each spectrum can be set as an input. Furthermore if required, the non-resonant susceptibility can be changed. An example is:\n\nN2_species  = N2Species(\n    molar_fraction = 0.9, \n    distribution = N2.FreeVibrationalDistribution(delta_f_vib = [0.9, 0.09, 0.01], \n                        T_rot = 600.0, closure = :temperature_extrapolation), \n    v_max = 3,\n    J_max = 50,\n    chi_non_resonant = 4.2e-51\n)\n\nCO2_species = CO2Species(\n    molar_fraction = 0.1, \n    distribution = CO2.MultiTemperatureDistribution(T_12 = 600.0, T_3 = 1800.0, T_rot = 600.0),\n    v_max = (1,2,1),  # v1, v2, v3\n    J_max = 80,\n    chi_non_resonant = 4.5e-51\n)\nnothing #hide","category":"section"},{"location":"Setup_for_spectra/#CARSSimulator","page":"Setup for Spectra Calculation","title":"CARSSimulator","text":"Finally, the created GasConditions, LaserConfiguration, InstrumentConfiguration and molecules such as N2Species and CO2Species are stored in the CARSSimulator struct\n\nsim  = CARSSimulator(\n    species    = [CO2_species, N2_species], \n    conditions = conditions, \n    lasers     = lasers, \n    instrument = instrument,\n)\nnothing #hide","category":"section"},{"location":"Setup_for_spectra/#Calculation-of-spectrum","page":"Setup for Spectra Calculation","title":"Calculation of spectrum","text":"A spectrum is simply evaluated from the CARSSimulator using \n\nsynthetic_spectrum = simulate_spectrum(sim)\nnothing #hide\n\nwhich returns a Spectrum containing the anti-Stokes wavenumbers and a intensity (not sqrt) of the anti-Stokes beam. \n\nwith_theme(theme_latexfonts()) do\n    fig = Figure(size = (1000, 700), fontsize = 40, figure_padding = 30)\n    ax = Axis(fig[1,1], \n        limits = ((494, 499), (-0.02, 1.1)),\n        xlabel = L\"$\\mathrm{λ_{aS} \\, (nm)}$\",\n        ylabel = L\"$\\mathrm{(CARS \\, intensity)^{1/2}}$\"\n    )\n    lines!(ax, 1e9 .* wavelengths(synthetic_spectrum), sqrt.(intensities(synthetic_spectrum, normalization = :maximum)))\n    fig\nend","category":"section"},{"location":"reference/#Reference","page":"References","title":"Reference","text":"Pages = [\"reference.md\"]","category":"section"},{"location":"reference/#NTECARS.CARSSimulator","page":"References","title":"NTECARS.CARSSimulator","text":"CARSSimulator(; species, conditions, lasers, instrument, grid_type, vertical_shift)\n\nstruct that contains all information for the calculation of a CARS spectrum.\n\nArguments\n\nspecies::Vector{T} where {T<:CARSSpecies}: Array of CARSSpecies such as CO2Species or N2Species\nconditions::GasConditions: bulk gas parameters used for calculating linewidths\nlasers::LaserConfiguration: information on laser wavelengths and profiles\ninstrument::InstrumentConfiguration: inforamtino on instrumental broadening profile\ngrid_type ::Symbol: Can be :adaptive or :uniform. the resolutions are automatically  determined from the linewidths of the given CARSSpecies at the temperature and pressure given in GasConditions\nvertical_shift::Float64 A vertical offset that is added to the spectrum at the end.  The spectra are normalized to the maximum so ∈ [0,1]\nwavelength_shift::Float64: Units of meters. Shifts the anti-Stokes wavelength to λ_aS + wavelength_shift. \n\n\n\n\n\n","category":"type"},{"location":"reference/#NTECARS.GasConditions","page":"References","title":"NTECARS.GasConditions","text":"GasConditions(;pressure::AbstractFloat, T_gas::AbstractFloat)\n\nContains the basis information of the pressure in Pa and translational temperature in K.\n\nThe pressure and translational temperature are used for calculating linewidths. When fitting, it should be remembered to update T_gas accordingly.\n\nExamples\n\nconditions = GasConditions(\n    pressure = 15000.0,\n    T_gas    = 600.0   \n)\n\n\n\n\n\n","category":"type"},{"location":"reference/#NTECARS.InstrumentConfiguration","page":"References","title":"NTECARS.InstrumentConfiguration","text":"InstrumentConfiguration(;profile::Union{DeltaProfile,Spectrum} = DeltaProfile())\n\nContains information about the broadening profile introduced by physical measurement devices (spectrometer). \n\nWhen no instrumental broadening is present, it should contain the default DeltaProfile(). Otherwise, profile can be given profiles created by existing functions such as Gaussian(σ), Voigt(σ, γ) or  PowerVoigt(σ, γ, n). Alternatively, a Spectrum containing a discrete spectrum can be used.  The profiles should be centered around 0 but do not have to be symmetric.\n\nExamples\n\nInstrumentConfiguration(profile = Gaussian(0.2/2.35))\n\n\n\n\n\n","category":"type"},{"location":"reference/#NTECARS.LaserConfiguration","page":"References","title":"NTECARS.LaserConfiguration","text":"LaserConfiguration(; wavelength_1, wavelength_2, stokes_range,\n                     profile_1=DeltaProfile(),\n                     profile_2=DeltaProfile(),\n                     stokes_profile=FlatProfile())\n\nStores the laser wavelengths and spectral profiles.\n\nArguments\n\nwavelength_1::Float64: Central wavelength of the first laser (in meters).\nwavelength_2::Float64: Central wavelength of the second laser (in meters).\nstokes_range::Tuple{Float64,Float64}: Wavelength range over which the Stokes spectrum is defined (in meters). This determines the range of anti-Stokes  frequencies together with the central wavelengths.\nprofile_1::Union{DeltaProfile, Spectrum}: Spectral profile of the first laser.\nprofile_2::Union{DeltaProfile, Spectrum}: Spectral profile of the second laser.\nstokes_profile::Spectrum: Stokes spectral profile. The Stokes-spectrum has to be defined at the correct physical spectral range (not around 0!). A FlatProfile should be used if  the experimental data is already normalized by the stokes-proflie/non-resonant background.\n\nNotes\n\nSpectrum can be created from user data or Gaussian(σ), Voigt(σ, γ), PowerVoigt(σ, γ, n)\nInternally, wavelengths are converted to wavenumbers.\nThe anti-Stokes limits are computed as extrema(ν₁ + ν₂ − stokes_range).\n\nExamples\n\nlasers = LaserConfiguration(\n    wavelength_1    = 532e-9,\n    wavelength_2    = 561e-9,\n    stokes_range    = (600e-9, 610e-9),\n    profile_1       = Gaussian(0.2), # inputs are σ in cm^-1\n    profile_2       = Voigt(0.1, 0.05), # inputs are σ, γ  in cm^-1\n    stokes_profile  = Spectrum([600e-9, 605e-9, 610e-0], [0.0, 1.0, 0.0], :wavelength)\n)\n\n\n\n\n\n","category":"type"},{"location":"reference/#NTECARS.Spectrum","page":"References","title":"NTECARS.Spectrum","text":"Spectrum(x::Vector{N}, I::Vector{T}, unit::Symbol) where {N,T}\n\ncreate a Spectrum from spectral positions x with intensitiy I.\n\nArguments\n\nx::Vector{N}: spectral positions at which the intensities are given. The units of x have to be specified by unit=:wavelength (meter) or unit=:wavenumber (cm^-1) to allow for spectra to be created from both.\nI::Vector{T}: intensities as spectral positions x.\nunit::Symbol: Can be wavelength or wavenumber. Specifies the units of x\n\nNotes\n\nInternally, the spectral positions are stored in wavenumber sorted from lowest to highest values.\n\nExample\n\nSpectrum([404e-9, 405e-9, 406e-9], [0.0, 1.0, 0.0], :wavelength)\nSpectrum([20000, 21000], [0.5, 1.0], :wavenumber)\n\n\n\n\n\n","category":"type"},{"location":"reference/#NTECARS.average_to_detector_pixels-Tuple{Spectrum, Any}","page":"References","title":"NTECARS.average_to_detector_pixels","text":"Bins a finely resolved spectrum defined at wavelengths ν with intensity I to the wavelengths ν_pixel\n\n\n\n\n\n","category":"method"},{"location":"reference/#NTECARS.fit_spectrum-Tuple{}","page":"References","title":"NTECARS.fit_spectrum","text":"fit_spectrum(; spec_exp, sim, parameter_update_function!, initial, lower, upper, \n    intensity_eval_function = x -> abs.(x ./ maximum(x)).^(1/2) , parameter_scaling_factor = initial)\n\nFits the the model to a measured spectrum.\n\nArguments\n\nspec_exp::Spectrum: The measured spectrum that should be fitted\nsim::CARSSimulator: Should contain all required inputs such as linewidths\nparameter_update_function!::Function: A function with the signature f(sim::CARSSimulator, param) that take a param array of length N and updates sim using these parameters.\ninitial::Vector{Float64}: Initial values of the fit parameters. Has to be of length N.\nlower::Vector{Float64}: Lower boundary of the fit parameters. Has to be of length N.\nupper::Vector{Float64}: upper boundary of the fit parameters. Has to be of length N.\nintensity_eval_function::Function = x -> abs.(x ./ maximum(x)).^(1/2), a function that is applied to  both the simulated and experimental spectrum before calculating the residuals. The default represents a fitting of the normalized sqaure-root of the CARS-intensity.\n\nreturn\n\nFitResult: contains parameters, spectra, uncertainties etc...\n\nExample\n\nWhich parameters are fitted toegther is determined by the parameter_update_function!.\n\nFor a sim::CARSSimulator that contains the species N2Species as the first element in sim.species,  the rotational and vibrational temperature can for example be fitted by defining the update function \n\nfunction update_function!(sim::CARSSimulator, param)\n    T_vib, T_rot = param\n    sim.conditions.T_gas = T_rot\n    sim.species[1].distribution = N2.MultiTemperatureDistribution(\n        T_vib = T_N2vib, T_rot = T_rot)\nend\n\nresult = fit_spectrum(;\n    spec_exp     = experimental_spectrum,\n    sim          = sim,\n    initial      = [500.0, 500.0],\n    lower        = [0.0, 0.0],\n    upper        = [3000.0, 3000.0],\n    parameter_update_function! = update_function!\n)\n\n\n\n\n\n","category":"method"},{"location":"reference/#NTECARS.intervals_around_points-Union{Tuple{T}, Tuple{Vector{T}, T}} where T<:Number","page":"References","title":"NTECARS.intervals_around_points","text":"creates an array of intervals that consist of (start_point, end_point) for all points\nin the positions array array with a width of window_width. Overlapping intervals ar merged\n\n\n\n\n\n","category":"method"},{"location":"reference/#NTECARS.parameters_that_modify_distributions-Tuple{Any, Any, Any}","page":"References","title":"NTECARS.parameters_that_modify_distributions","text":"parameters_that_modify_distributions(sim_, parameter_update_function!, parameters)\n\nFind out which parameters modify the distrution function of CO2 or N2 This is needed the know which paraeters can be extended with uncertainties via Measurements.jl since this is only supported for the distribution functions right now.\n\n\n\n\n\n","category":"method"},{"location":"reference/#NTECARS.raman_shifts-Tuple{}","page":"References","title":"NTECARS.raman_shifts","text":"\n\n\n\n","category":"method"},{"location":"reference/#NTECARS.resample_to_resolution-Tuple{Spectrum, Any}","page":"References","title":"NTECARS.resample_to_resolution","text":"Samples the given spectrum at a given resolution via interpolation. Used for convolutions with\nthe instrumental broadening profile.\n\n\n\n\n\n","category":"method"},{"location":"reference/#NTECARS.rovibrational_populations_database-Tuple{CO2Species}","page":"References","title":"NTECARS.rovibrational_populations_database","text":"Generate vibrational and rovibrational populations for a distribution function. If any parameter has\nan uncertainty using measurements.jl, then the results will have the corresponding uncertainties\n\n\n\n\n\n","category":"method"},{"location":"reference/#NTECARS.rovibrational_populations_database-Tuple{N2Species}","page":"References","title":"NTECARS.rovibrational_populations_database","text":"Generate vibrational and rovibrational populations for a distribution function. If any parameter has\nan uncertainty using measurements.jl, then the results will have the corresponding uncertainties\n\n\n\n\n\n","category":"method"},{"location":"reference/#NTECARS.sampling_points_from_intervals-NTuple{4, Any}","page":"References","title":"NTECARS.sampling_points_from_intervals","text":"creates an array of sampling points in the range specified by \"limits\".\nIn the specified intervals, the points are sampled with the fine resolution\nΔx_fine and inbetween them with Δx_coarse\n\n\n\n\n\n","category":"method"},{"location":"reference/#NTECARS.total_susceptibility-Tuple{CARSSimulator}","page":"References","title":"NTECARS.total_susceptibility","text":"total_susceptibility(sim::CARSSimulator)\n\ntest2\n\n\n\n\n\n","category":"method"},{"location":"#NETCARS:-Non-Equilibrium-CARS-Spectra-Fitting-Code","page":"Home","title":"NETCARS: Non-Equilibrium CARS Spectra Fitting Code","text":"The NTECARS.jl code is a flexible tool for the calculation and fitting CARS spectra under non-equilibrium conditions. A key strength of the code is the flexibility to model rovibrational distributions using either pre-implemented multi-temperature distribution functions, user-defined functions or to freely fit vibrational populations without the assumption of any distribution function. This flexibility enables the quantitative interpretation of CARS spectra under both equilibrium and strongly non-equilibrium conditions.","category":"section"},{"location":"#Installation","page":"Home","title":"Installation","text":"using Pkg\nPkg.add(url=\"https://github.com/Optical-Diagnostics/NTECARS\")","category":"section"},{"location":"#Minimal-example-for-CARS-spectrum","page":"Home","title":"Minimal example for CARS spectrum","text":"using NTECARS\n\nconditions = GasConditions(\n    pressure = 15000.0, # in Pa\n    T_gas    = 600.0    # in K\n)\n\nlasers = LaserConfiguration(\n    wavelength_1 = 532e-9,  # First laser wavelength in nm \n    wavelength_2 = 561e-9,  # Second laser wavelength in nm\n    stokes_range = (603e-9, 611e-9),\n)\n\ninstrument = InstrumentConfiguration(\n    profile = Gaussian(0.5/2.35)\n)\n\nN2_species = N2Species(\n    molar_fraction = 0.9, \n    distribution = N2.MultiTemperatureDistribution(T_vib = 2200.0, T_rot = 600.0), \n)\n\nCO2_species = CO2Species(\n    molar_fraction = 0.1, \n    distribution = CO2.MultiTemperatureDistribution(T_12 = 600.0, T_3 = 1800.0, T_rot = 600.0),\n    v_max = (0,1,1)\n)\n\nsim  = CARSSimulator(\n    species    = [CO2_species, N2_species], \n    conditions = conditions, \n    lasers     = lasers, \n    instrument = instrument,\n)\n\nsynthetic_spectrum = simulate_spectrum(sim)\nnothing # hide","category":"section"}]
}
